<?xml version="1.0" encoding="UTF-8"?>

<Rules>
	<Condition type="Perception" perception="Add Note">

		<!-- First Note added -->
		<Condition type="DataMining" operation="Exists"	event="Add Note" compareValue="0" memory="WM">
			<Action name="Think" value="First Note" />
			<Condition type="Perception" perception="Add Note" value="Do">
				<Action name="Think" value="Good Note" />
				<Emotion name="Joy" increment="2" max="10" />
				<Storage event="Start Note" value="Do" />
			</Condition>
			<Condition type="Perception" perception="Add Note" value="Re">
				<Action name="Think" value ="Bad Note" />
				<Emotion name="Joy" increment="-2" max="-8" />
				<Storage event="Start Note" value="Re" />
			</Condition>
			<Condition type="Perception" perception="Add Note" value="Mi">
				<Action name="Think" value ="Good Note" />
				<Emotion name="Joy" increment="2" max="8" />
				<Storage event="Start Note" value="Mi" />
			</Condition>
			<Condition type="Perception" perception="Add Note" value="Fa">
				<Action name="Think" value ="Bad Note" />
				<Emotion name="Joy" increment="-1" min="-5"/>
				<Storage event="Start Note" value="Fa" />
			</Condition>
			<Condition type="Perception" perception="Add Note" value="Sol">
				<Action name="Think" value ="Good Note" />
				<Emotion name="Joy" increment="2" max="9" />
				<Storage event="Start Note" value="Sol" />
			</Condition>
			<Condition type="Perception" perception="Add Note" value="La">
				<Action name="Think" value ="Bad Note" />
				<Emotion name="Joy" increment="-1" min="-5" />
				<Storage event="Start Note" value="La" />
			</Condition>
			<Condition type="Perception" perception="Add Note" value="Si">
				<Action name="Think" value ="Bad Note" />
				<Emotion name="Joy" increment="-2" min="-10" />
				<Storage event="Start Note" value="Si" />
			</Condition>
			<Condition type="Perception" perception="Add Note" value="Do Agudo">
				<Action name="Think" value ="Good Note" />
				<Emotion name="Joy" increment="2" max="10" />
				<Storage event="Start Note" value="Do Agudo" />
			</Condition>
			<Condition type="Perception" perception="Add Note" value="Pause">
				<Action name="Think" value ="Bad Note" />
				<Emotion name="Joy" increment="-2" min="-10" />
				<Storage event="Start Note" value="Pause" />
			</Condition>
		</Condition>

		<!-- Test if there is already one note -->
		<Condition type="DataMining" operation="Exists"	event="Add Note" compareValue="1" memory="WM">
			<DataMining operation="Last" event="Add Note" variable="[Last Note]"  memory="WM">
				<!-- Do -->
				<Condition type="Perception" perception="Add Note" value="Do">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="2" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="1" max="7" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="2" max="9" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="-2" min="-7" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="-2" min="-10"/>
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="1" max="0" />
						<Action name="Think" value ="Good Note" />
					</Condition>
				</Condition>

				<!-- Re -->
				<Condition type="Perception" perception="Add Note" value="Re">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="1" max="7" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="1" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="1" max="0" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="-1" max="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="-2" max="-7" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="-2" max="-10" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="-1" max="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
				</Condition>

				<!-- Mi -->
				<Condition type="Perception" perception="Add Note" value="Re">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="1" max="7" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="1" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="1" max="7" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="2" max="9" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="-1" min="-7" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="-2" min="-7" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
				</Condition>

				<!-- Fa -->
				<Condition type="Perception" perception="Add Note" value="Mi">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="1" max="7" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="2" max="9" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="2" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="1" max="0" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="-2" max="-10" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="-1" max="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
				</Condition>

				<!-- Sol -->
				<Condition type="Perception" perception="Add Note" value="Sol">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="-2" max="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="2" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="1" max="7" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="1" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="1" max="7" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="2" max="9" />
						<Action name="Think" value ="Good Note" />
					</Condition>
				</Condition>

				<!-- La -->
				<Condition type="Perception" perception="Add Note" value="La">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="-1" min="-7" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="1" max="7" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="2" max="9" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="1" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="-1" min="-5"/>
						<Action name="Think" value ="Bad Note" />
					</Condition>
				</Condition>

				<!-- Si -->
				<Condition type="Perception" perception="Add Note" value="Si">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="-2" min="-10" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="-1" min="-7" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="-2" max="-10" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="-1" max="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="2" max="9" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="1" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
				</Condition>

				<!-- Do agudo -->
				<Condition type="Perception" perception="Add Note" value="Do Agudo">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="1" max="0" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="-2" min="-10" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="-1" min="-7" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="2" max="9"/>
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="1" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
				</Condition>

				<!-- Do agudo -->
				<Condition type="Perception" perception="Add Note" value="Pause">
					<Condition type="Variable" variable="[Last Note]" compareValue="Do">
						<Emotion name="Joy" increment="1" max="0" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Re">
						<Emotion name="Joy" increment="-2" min="-10" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Mi">
						<Emotion name="Joy" increment="-1" min="-5" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Fa">
						<Emotion name="Joy" increment="-1" min="-7" />
						<Action name="Think" value ="Bad Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Sol">
						<Emotion name="Joy" increment="2" max="10" />
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="La">
						<Emotion name="Joy" increment="-1" min="-5" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Si">
						<Emotion name="Joy" increment="2" max="9"/>
						<Action name="Think" value ="Good Note" />
					</Condition>
					<Condition type="Variable" variable="[Last Note]" compareValue="Do Agudo">
						<Emotion name="Joy" increment="1" max="8" />
						<Action name="Think" value ="Good Note" />
					</Condition>
				</Condition>

				<Action name="Think" value="Sequence [Last Note] [Perception.value]" />

			</DataMining>
		</Condition>

		<!-- If there are no notes -->
		<Condition type="DataMining" operation="Exists"	event="Add Note" compareValue="0" memory="WM">

		</Condition>


		<!-- Save note added to the memory -->
		<Storage event="Add Note" value="[Perception.value]" memory="WM" />
		<Storage event="Add Note" value="[Perception.value]" memory="LTM" />

		<!-- -->
	</Condition>

	<!-- When a duration is added -->
	<Condition type="Perception" perception="Add Duration">
		<!-- Calculate the music lenght -->
		<DataMining operation="Sum" event="Add Duration" variable="[Music Duration]" memory="WM">
			<Action name="Think" value ="Music Duration [Music Duration]" />
			MusicLength
			<!-- Check how much tempos from the compass have been used -->
			<MathOperation name="Remainder" variable="[Music Duration]" value="4" result="[Duration]">

				<!-- Compass with 0 durations -->

				<Condition type="Variable" variable="[Duration]" compareValue="0">
					<Condition type="Perception" perception="Add Duration" value="1">
						<Emotion name="Joy" increment="1" max="2" />
						<Action name="Think" value ="Good Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="2">
						<Emotion name="Joy" increment="1" max="2" />
						<Action name="Think" value ="Good Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="3">
						<Emotion name="Joy" increment="1" max="2" />
						<Action name="Think" value ="Good Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="4">
						<Emotion name="Joy" increment="1" max="2" />
						<Action name="Think" value ="Good Duration" />
					</Condition>
				</Condition>

				<!-- Compass with 1 durations -->
				<Condition type="Variable" variable="[Duration]" compareValue="1">
					<Condition type="Perception" perception="Add Duration" value="1">
						<Emotion name="Joy" increment="1" max="10" />
						<Action name="Think" value ="Good Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="2">
						<Emotion name="Joy" increment="-4" min="-10" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="3">
						<Emotion name="Joy" increment="-4" min="-10" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="4">
						<Emotion name="Joy" increment="-4" min="-10" />
					</Condition>
				</Condition>

				<!-- Compass with 2 durations -->
				<Condition type="Variable" variable="[Duration]" compareValue="2">
					<Condition type="Perception" perception="Add Duration" value="1">
						<Emotion name="Joy" increment="1" max="8" />
						<Action name="Think" value ="Good Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="2">
						<Emotion name="Joy" increment="1" max="10" />
						<Action name="Think" value ="Good Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="3">
						<Emotion name="Joy" increment="-4" min="-10" />
						<Action name="Think" value ="Bad Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="4">
						<Emotion name="Joy" increment="-4" min="-10" />
						<Action name="Think" value ="Bad Duration" />
					</Condition>
				</Condition>

				<!-- Compass with 3 durations -->
				<Condition type="Variable" variable="[Duration]" compareValue="3">
					<Condition type="Perception" perception="Add Duration" value="1">
						<Emotion name="Joy" increment="1" max="10" />
						<Action name="Think" value ="Good Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="2">
						<Emotion name="Joy" increment="-4" min="-10" />
						<Action name="Think" value ="Bad Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="3">
						<Emotion name="Joy" increment="-4" min="-10" />
						<Action name="Think" value ="Bad Duration" />
					</Condition>
					<Condition type="Perception" perception="Add Duration" value="4">
						<Emotion name="Joy" increment="-4" min="-10" />
						<Action name="Think" value ="Bad Duration" />
					</Condition>
				</Condition>

				<!-- Think the current compass duration and the duration choosen -->
				<Action name="Think" value="Compass Duration [Duration] [Perception.value]" />

			</MathOperation>



			<Storage event="Add Duration" value="[Perception.value]" memory="WM" />
			<Storage event="Add Duration" value="[Perception.value]" memory="LTM" />

			<Action name="Talk" value="Evaluation Note" />

		</DataMining>
	</Condition>


</Rules>
